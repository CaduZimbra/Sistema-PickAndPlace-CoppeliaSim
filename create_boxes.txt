function sysCall_thread()


    local conveyorCtrlPtName = '/conveyorSystem/_ctrlPt[0]' -- Caminho para a esteira
    local conveyorCtrlPt = sim.getObject(conveyorCtrlPtName)
    local checkInterval = 10.0 -- Verifica a cada meio segundo se pode criar
    local creationDelay = 30.0 -- Tempo entre criacoes QUANDO a esteira esta livre
    local timeSinceLastCreation = creationDelay -- Inicia permitindo criar logo

    while sim.getSimulationState() ~= sim.simulation_advancing_abouttostop do

        -- Le o sinal enviado pelo script do sensor
        local detectionState = sim.getInt32Signal('detectedBox')
        if detectionState == nil then detectionState = 0 end 

        -- So tenta criar se a esteira NaO estiver parada 
        -- E se ja passou tempo suficiente
        if detectionState == 0 and timeSinceLastCreation >= creationDelay then

             

            local pos = math.random(1, 3)
            local color = {0, 0, 0}
            color[pos] = 1

            -- Cria o cubo
            local shapeHandle = sim.createPrimitiveShape(sim.primitiveshape_cuboid, {0.05, 0.05, 0.05})

            -- Configura posicao e cor
            sim.setObjectPosition(shapeHandle, conveyorCtrlPt, {0, 0.1, 0.2})
            sim.setShapeColor(shapeHandle, nil, sim.colorcomponent_ambient_diffuse, color)

            -- Definindo Propriedades 

            sim.setObjectInt32Param(shapeHandle, sim.shapeintparam_static, 0)

            sim.setObjectInt32Param(shapeHandle, 3004, 1)
          

        
            sim.setObjectSpecialProperty(shapeHandle,
                sim.objectspecialproperty_collidable +
                sim.objectspecialproperty_measurable +
                sim.objectspecialproperty_detectable )

          


             timeSinceLastCreation = 0 -- Reseta o contador

        elseif detectionState == 1 then
             timeSinceLastCreation = creationDelay -- Reseta para criar assim que liberar
        else
            -- Esteira livre
        end

        -- Espera antes de verificar novamente
        sim.wait(checkInterval)
        if detectionState == 0 then
            timeSinceLastCreation = timeSinceLastCreation + checkInterval
        end

    end -- Fim do while

    sim.wait(30)
end

